#!/usr/bin/env bash
set -euo pipefail

# Launcher: prefer project .venv, then pyenv

PROJECT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"

# 1) Use project venv if present
if [ -x "$PROJECT_DIR/.venv/bin/python" ]; then
  exec "$PROJECT_DIR/.venv/bin/python" "$PROJECT_DIR/main.py" "$@"
fi

# 2) Use pyenv if available (respects .python-version)
if command -v pyenv >/dev/null 2>&1; then
  if pyenv which python >/dev/null 2>&1; then
    exec pyenv exec python "$PROJECT_DIR/main.py" "$@"
  fi
fi

echo "❌ Окружение не настроено. Создайте .venv или настройте pyenv для проекта." >&2
echo "ℹ️  См. README.md: раздел 'Setup on macOS'" >&2
exit 1